{% extends "registro/base.html" %}
{% block titulo %}Actualizar{% endblock %}
{% block cuerpo %}
<form method="post">{% csrf_token %}

  {{ form.as_p }}

  <input type="submit" value="Submit" />
</form>
<script type="text/javascript">
$("document").ready(function (){
  (function(){

    var id_direccion = document.getElementById("id_direccion");
    var id_director = document.getElementById("id_director");

    {% for direccion in direcciones %}
      var direccion_{{ direccion.id }} = new Array();
      var direccion_{{ direccion.id }}_id = new Array();
      {% for director in directores %}
        {% if director.direccion_perteneciente.id == direccion.id %}
          var director_{{director.id }} = new Array();
          var director_{{director.id }}_id = new Array();
          direccion_{{ direccion.id }}.push('{{ director.nombre_director }}');
          direccion_{{ direccion.id }}_id.push('{{ director.id }}');
        {% endif %}
      {% endfor %}
    {% endfor %}

    // 3. Crear el evento que escuchará e imprimirá las opciones al cambiar el select "direccion" 
    id_direccion.addEventListener('change',function(){
      // Valor del select "id_direccion"
      let direccion_seleccionado = this.value;
      // Verifica la validez de direccion_seleccionado
      if(direccion_seleccionado != 0) {
        // Selecciona el array que se llame como el servicio que se seleccionó
        array_del_direccion = eval("direccion_" + direccion_seleccionado);
        array_del_direccion_id = eval("direccion_" + direccion_seleccionado + "_id");
        // Calcula el número de elementos que se imprimirá en el combobox
        cantidad_directores = array_del_direccion.length;
        // Se le asigna el largo de array al combobox
        id_director.length = cantidad_directores + 1;
        id_director.options[0].value = "";
        id_director.options[0].text = "-----";
        // Imprime las opciones en el combobox
        for(i=0; i < cantidad_directores; i++){
          id_director.options[i+1].value = array_del_direccion_id[i];
          id_director.options[i+1].text = array_del_direccion[i];
        }
      }
      else {
        // si no habia ninguna opt seleccionada, se eliminan  del select
        id_director.length = 1;
        //ponemos un guion en la unica opt que he dejado
        id_director.options[0].value="";
        id_director.options[0].text="Seleccione un director";
      }
    }, true);
    id_director.addEventListener('change',function(){
      // Valor del select "id_direccion"
      let direccion_seleccionado = this.value;
      // Verifica la validez de direccion_seleccionado
      if(direccion_seleccionado != 0) {
        // Selecciona el array que se llame como el servicio que se seleccionó
        array_del_direccion = eval("director_" + direccion_seleccionado);
        array_del_direccion_id = eval("director_" + direccion_seleccionado + "_id");
        // Calcula el número de elementos que se imprimirá en el combobox
        cantidad_directores = array_del_direccion.length;
        // Se le asigna el largo de array al combobox
        // Imprime las opciones en el combobox
        for(i=0; i < cantidad_directores; i++){
          id_parroquia.options[i+1].value = array_del_direccion_id[i];
          id_parroquia.options[i+1].text = array_del_direccion[i];
        }
      }
      else {
        alert("xxxxxxxxx");
      }
    }, true);
    })();
});
</script>
{% endblock %}